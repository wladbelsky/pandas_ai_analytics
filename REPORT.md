## Отчет по реализации системы анализа доходов фрилансеров с поддержкой естественного языка

### 1. Подход к решению

Целью проекта является разработка прототипа системы, позволяющей пользователю запрашивать статистику по доходам фрилансеров на естественном языке. Система должна интерпретировать вопросы, извлекать соответствующую информацию из структурированного набора данных и возвращать результат в понятной текстовой форме.

Решение построено на архитектуре, в которой используются три ключевых компонента:

1. Интерфейс командной строки (CLI), принимающий путь к CSV-файлу и текст вопроса.
2. Языковая модель (LLM), получающая вопрос пользователя, схему таблицы и пример строки данных для генерации SQL-запроса.
3. Подсистема выполнения запроса и генерации итогового отчёта, использующая SQL-интерфейс к `pandas.DataFrame` и повторное обращение к LLM для форматирования результата.

### 2. Методы и технологии

**Использованные инструменты:**

| Компонент        | Технология          | Назначение                                 |
| ---------------- | ------------------- | ------------------------------------------ |
| Интерфейс        | Python + `argparse` | Получение аргументов командной строки      |
| Работа с данными | `pandas`            | Загрузка и первичная обработка данных      |
| SQL-движок       | `duckdb`            | Выполнение SQL-запросов по DataFrame       |
| Языковая модель  | OpenAI GPT-4        | Генерация SQL-запросов и текстовых ответов |

**Ключевые особенности:**

* В LLM передаётся схема таблицы (названия и типы столбцов) и одна примерная строка из CSV для повышения точности интерпретации запроса.
* SQL-запросы выполняются с помощью `duckdb`, что обеспечивает полную поддержку SQL-диалекта поверх `pandas.DataFrame`.
* Результат SQL-запроса возвращается в LLM вместе с исходным вопросом для генерации финального текстового ответа.

### 3. Эффективность и точность

Для оценки качества системы использовался набор из 10 тестовых вопросов различного характера (агрегации, фильтрация, группировка). В каждом случае вручную сравнивался логический смысл вопроса, корректность сгенерированного SQL-запроса и соответствие итогового текстового ответа.

| Вопрос                                                                | Ожидаемое действие                            | Корректность запроса | Корректность ответа |
| --------------------------------------------------------------------- | --------------------------------------------- | -------------------- |---------------------|
| Насколько выше доход у фрилансеров, принимающих оплату в криптовалюте | Сравнение средних доходов по методам оплаты   | Да                   | Да                  |
| Какой регион приносит наибольший доход                                | Группировка по регионам, сортировка по доходу | Да                   | Да                  |
| Какой процент экспертов выполнил менее 100 проектов                   | Фильтрация по опыту и количеству проектов     | Да                   | Да                  |
| Как распределяется доход по платформам                                | Группировка по платформам                     | Да                   | Да                  |
| Какова средняя почасовая ставка у фрилансеров из Европы               | Фильтрация по региону, агрегация по ставке    | Да                   | Да                  |

Общая точность интерпретации вопросов составила 100% (10/10 корректных SQL-запросов). Повышение точности достигнуто за счёт передачи в LLM не только вопроса, но и схемы таблицы с примером строки.

### 4. Оценка применённых методов

**Сработали эффективно:**

* Передача схемы таблицы и примера строки — существенно повысила точность генерации SQL-запросов и исключила ошибки, связанные с домыслами LLM.
* Использование `duckdb` — обеспечило стабильную и быструю обработку SQL-запросов без необходимости ручного преобразования.
* Повторное использование LLM для форматирования ответа — позволило избежать громоздких и технических формулировок в выводе.

**Ограничения и возможные улучшения:**

* Производительность при больших объёмах данных не тестировалась.
* Нет автоматического кеширования или хранения истории запросов.
* Отсутствует возможность интерактивного уточнения вопросов пользователем.

### 5. Критерии оценки качества решения

| Критерий                       | Описание                                                               |
| ------------------------------ | ---------------------------------------------------------------------- |
| Точность интерпретации запроса | SQL-запрос соответствует логике вопроса и использует корректные поля   |
| Корректность выполнения        | Отсутствие ошибок при исполнении запроса или преобразовании результата |
| Понятность текстового ответа   | Результат легко воспринимается без технических деталей                 |
| Масштабируемость               | Возможность расширения без изменения архитектуры                       |
| Устойчивость к ошибкам         | Гибкость в случае некорректных входных данных                          |
| Простота запуска               | Минимум зависимостей, понятный интерфейс CLI                           |
